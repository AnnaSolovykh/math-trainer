import { makeAutoObservable } from "mobx";

type Mode = "multiply" | "divide" | "mixed";

class TrainerStore {
  mode: Mode = "multiply";
  currentQuestion = "";
  correctAnswer = 0;
  userInput = "";
  feedback: "correct" | "wrong" | null = null;
  isInitialized = false; // –§–ª–∞–≥ –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
  
  // –°—á–µ—Ç—á–∏–∫–∏ –¥–ª—è —á–µ—Ä–µ–¥–æ–≤–∞–Ω–∏—è —Ñ—Ä–∞–∑
  correctMessageIndex = 0;
  wrongMessageIndex = 0;
  
  correctMessages = [
    "üèÜ –ü–æ—Ç—Ä—è—Å–∞—é—â–µ! –¢—ã –Ω–∞—Å—Ç–æ—è—â–∏–π –≥–µ–Ω–∏–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏! ‚ú®",
    "‚≠ê –ë–ª–µ—Å—Ç—è—â–µ! –¢—ã —É–º–Ω–∏—Ü–∞! üåü",
    "üéâ –ù–µ–≤–µ—Ä–æ—è—Ç–Ω–æ! –£ —Ç–µ–±—è –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Ç–∞–ª–∞–Ω—Ç! üöÄ",
    "üëë –í–µ–ª–∏–∫–æ–ª–µ–ø–Ω–æ! –¢—ã –∫–æ—Ä–æ–ª–µ–≤–∞ —á–∏—Å–µ–ª! üíé",
    "üåà –§–∞–Ω—Ç–∞—Å—Ç–∏–∫–∞! –¢—ã —Ä–µ—à–∞–µ—à—å –∫–∞–∫ –≤–æ–ª—à–µ–±–Ω–∏—Ü–∞! ‚ú®",
    "ü¶Ñ –£–¥–∏–≤–∏—Ç–µ–ª—å–Ω–æ! –¢—ã –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –ø—Ä–∏–Ω—Ü–µ—Å—Å–∞! üí´",
    "üéØ –¢–æ—á–Ω–æ –≤ —Ü–µ–ª—å! –¢—ã —Å—É–ø–µ—Ä–≥–µ—Ä–æ–π –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏! ü¶∏‚Äç‚ôÄÔ∏è",
    "üåü –°–∏—è–µ—à—å –∫–∞–∫ –∑–≤–µ–∑–¥–∞! –¢—ã –ø—Ä–æ—Å—Ç–æ –∫–ª–∞—Å—Å! ‚ú®",
    "üèÖ –ß–µ–º–ø–∏–æ–Ω–∫–∞! –¢—ã –ø–æ–∫–æ—Ä—è–µ—à—å —á–∏—Å–ª–∞! üéä",
    "üíù –ü—Ä–µ–∫—Ä–∞—Å–Ω–æ! –£ —Ç–µ–±—è –∑–æ–ª–æ—Ç–∞—è –≥–æ–ª–æ–≤–∞! üë∏",
    "ü¶ã –õ–µ–≥–∫–æ –∏ –∫—Ä–∞—Å–∏–≤–æ! –¢—ã –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Ñ–µ—è! ‚ú®",
    "üå∫ –í–æ—Å—Ö–∏—Ç–∏—Ç–µ–ª—å–Ω–æ! –¢—ã —Ü–≤–µ—Ç–æ—á–µ–∫ —É–º–Ω—ã–π! üå∏",
    "üé™ –ë—Ä–∞–≤–æ! –¢—ã –∑–≤–µ–∑–¥–∞ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ —Ü–∏—Ä–∫–∞! ‚≠ê",
    "üçÄ –£–¥–∞—á–∞ —É–ª—ã–±–∞–µ—Ç—Å—è —É–º–Ω–∏—Ü–∞–º! –¢—ã –º–æ–ª–æ–¥—á–∏–Ω–∞! üåü",
    "üé® –¢–≤–æ—Ä–∏—à—å –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ —á—É–¥–µ—Å–∞! –¢—ã —Ö—É–¥–æ–∂–Ω–∏—Ü–∞ —á–∏—Å–µ–ª! üñåÔ∏è"
  ];
  
  wrongMessages = [
    "üåü –£ —Ç–µ–±—è –ø–æ–ª—É—á–∏—Ç—Å—è! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑! üöÄ",
    "üí™ –¢—ã —Å–∏–ª—å–Ω–∞—è! –ù–µ —Å–¥–∞–≤–∞–π—Å—è, –ø—Ä–∏–Ω—Ü–µ—Å—Å–∞! üëë",
    "ü¶Ñ –ö–∞–∂–¥–∞—è –æ—à–∏–±–∫–∞ –¥–µ–ª–∞–µ—Ç —Ç–µ–±—è —É–º–Ω–µ–µ! ‚ú®",
    "üåà –¢—ã –Ω–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º –ø—É—Ç–∏! –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞! üí´",
    "üå∏ –î—ã—à–∏ –≥–ª—É–±–∂–µ –∏ –ø–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑! üå∫",
    "‚≠ê –ó–≤–µ–∑–¥–æ—á–∫–∏ –Ω–µ —Å—Ä–∞–∑—É –∑–∞–≥–æ—Ä–∞—é—Ç—Å—è! –¢—ã —Å–ø—Ä–∞–≤–∏—à—å—Å—è! üåü",
    "ü¶ã –ö–∞–∫ –±–∞–±–æ—á–∫–∞ —É—á–∏—Ç—Å—è –ª–µ—Ç–∞—Ç—å - –ø–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞! üíï",
    "üéØ –ü–æ—á—Ç–∏ –ø–æ–ø–∞–ª–∞! –ï—â–µ –æ–¥–∏–Ω –≤—ã—Å—Ç—Ä–µ–ª! üèπ",
    "üåª –†–∞—Å—Ç–µ—à—å –∏ —É—á–∏—à—å—Å—è! –ü–æ–ø—Ä–æ–±—É–π –µ—â–µ —Ä–∞–∑! üå±",
    "üé™ –î–∞–∂–µ –∞–∫—Ä–æ–±–∞—Ç—ã –ø–∞–¥–∞—é—Ç! –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞! ü§∏‚Äç‚ôÄÔ∏è",
    "üçÄ –£–¥–∞—á–∞ –ª—é–±–∏—Ç —Å–º–µ–ª—ã—Ö! –î–∞–≤–∞–π –µ—â–µ —Ä–∞–∑! üí™",
    "üé® –û—à–∏–±–∫–∏ - —ç—Ç–æ –Ω–∞–±—Ä–æ—Å–∫–∏ –∫ —à–µ–¥–µ–≤—Ä—É! üñåÔ∏è",
    "ü¶∏‚Äç‚ôÄÔ∏è –°—É–ø–µ—Ä–≥–µ—Ä–æ–∏ –Ω–µ –±–æ—è—Ç—Å—è —Ç—Ä—É–¥–Ω–æ—Å—Ç–µ–π! üí•",
    "üåô –î–∞–∂–µ –ª—É–Ω–∞ –Ω–µ –≤—Å–µ–≥–¥–∞ –ø–æ–ª–Ω–∞—è! –ü–æ–ø—Ä–æ–±—É–π —Å–Ω–æ–≤–∞! ‚≠ê",
    "üéµ –ò–≥—Ä–∞–π —Å–≤–æ—é –º–µ–ª–æ–¥–∏—é –º–∞—Ç–µ–º–∞—Ç–∏–∫–∏! üéº"
  ];

  constructor() {
    makeAutoObservable(this);
    // –ù–ï –≤—ã–∑—ã–≤–∞–µ–º generateQuestion –≤ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–µ!
  }

  // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–æ–ª—å–∫–æ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
  initialize() {
    if (!this.isInitialized) {
      this.isInitialized = true;
      this.generateQuestion();
    }
  }

  setMode(newMode: Mode) {
    this.mode = newMode;
    if (this.isInitialized) {
      this.generateQuestion();
    }
    this.feedback = null;
  }

  generateQuestion() {
    // –ü—Ä–æ–≤–µ—Ä—è–µ–º, —á—Ç–æ –º—ã –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ
    if (typeof window === 'undefined') return;
    
    const a = Math.floor(Math.random() * 10 + 1);
    const b = Math.floor(Math.random() * 10 + 1);
    
    if (this.mode === "multiply") {
      this.currentQuestion = `${a} √ó ${b}`;
      this.correctAnswer = a * b;
    } else if (this.mode === "divide") {
      this.currentQuestion = `${a * b} √∑ ${a}`;
      this.correctAnswer = b;
    } else {
      // –î–ª—è —Å–º–µ—à–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º–∞ - –≤—ã–±–∏—Ä–∞–µ–º —Å–ª—É—á–∞–π–Ω–æ
      const randomMode = Math.random() > 0.5 ? "multiply" : "divide";
      const oldMode = this.mode;
      this.mode = randomMode;
      this.generateQuestion();
      this.mode = oldMode; // –í–æ–∑–≤—Ä–∞—â–∞–µ–º –æ–±—Ä–∞—Ç–Ω–æ "mixed"
    }
  }

  // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
  getCurrentCorrectMessage() {
    return this.correctMessages[this.correctMessageIndex];
  }

  // –ü–æ–ª—É—á–∏—Ç—å —Ç–µ–∫—É—â–µ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –¥–ª—è –æ—à–∏–±–∫–∏
  getCurrentWrongMessage() {
    return this.wrongMessages[this.wrongMessageIndex];
  }

  checkAnswer() {
    const answer = Number(this.userInput);
    if (answer === this.correctAnswer) {
      this.feedback = "correct";
      // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤
      this.correctMessageIndex = (this.correctMessageIndex + 1) % this.correctMessages.length;
      
      setTimeout(() => {
        this.feedback = null;
        this.generateQuestion();
        this.userInput = "";
      }, 4000); // 4 —Å–µ–∫—É–Ω–¥—ã –¥–ª—è –ø—Ä–∞–≤–∏–ª—å–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞
    } else {
      this.feedback = "wrong";
      // –ü–µ—Ä–µ—Ö–æ–¥–∏–º –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é –¥–ª—è –æ—à–∏–±–æ–∫
      this.wrongMessageIndex = (this.wrongMessageIndex + 1) % this.wrongMessages.length;
      
      // –£–±–∏—Ä–∞–µ–º –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç —á–µ—Ä–µ–∑ 4 —Å–µ–∫—É–Ω–¥—ã –∏ –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –∫ –ø—Ä–∏–º–µ—Ä—É
      setTimeout(() => {
        this.feedback = null;
      }, 4000); // 4 —Å–µ–∫—É–Ω–¥—ã –ø–æ–∫–∞–∑—ã–≤–∞–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ –¥—Ä–∞–∫–æ–Ω–∞
    }
  }

  // –°–±—Ä–æ—Å –¥–ª—è –Ω–æ–≤–æ–≥–æ –≤–æ–ø—Ä–æ—Å–∞
  nextQuestion() {
    this.feedback = null;
    this.userInput = "";
    this.generateQuestion();
  }
}

export const trainerStore = new TrainerStore();